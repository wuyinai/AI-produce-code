<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wuyinai.wuaipdce.mapper.UserMapper">

    <!--返回值为对象    -->
    <select id="getAppChatNumber" resultType="com.wuyinai.wuaipdce.model.dto.user.UserAppChatNumberDTO">
        SELECT
            IFNULL(appStats.appNumber, 0) AS appNumber,
            IFNULL(appStats.selectedAppNumber, 0) AS selectedAppNumber,
            IFNULL(chatStats.chatNumber, 0) AS chatNumber
        FROM
            (SELECT
                 COUNT(*) AS appNumber,
                 SUM(CASE WHEN priority = 99 THEN 1 ELSE 0 END) AS selectedAppNumber
             FROM app
             WHERE userId = #{id} AND isDelete = 0) AS appStats
                CROSS JOIN
            (SELECT
                 COUNT(*) AS chatNumber
             FROM chat_history
             WHERE userId = #{id} AND isDelete = 0) AS chatStats
    </select>
</mapper>
